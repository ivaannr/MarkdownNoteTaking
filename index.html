<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Markdown Upload & Dropdown</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-dark text-light py-5">
    
    <div class="container">
        <div class="card bg-secondary text-light shadow mb-4">
            <div class="card-body">
                <h2 class="card-title mb-4">Upload Markdown File</h2>
                <form action="http://localhost:8080/upload" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="file" class="form-label">Choose your file</label>
                        <input class="form-control bg-dark text-light border-light" type="file" name="file" id="file" required />
                    </div>
                    <button type="submit" class="btn btn-outline-light">Upload</button>
                </form>
            </div>
        </div>

        <div class="card bg-secondary text-light shadow">
            <div class="card-body">
                <h3>Select an action</h3>
                <select id="actionDropdown" class="form-select bg-dark text-light border-light" aria-label="Select action">
                    <option selected disabled>Choose an option...</option>
                    <option value="render">Render markdown</option>
                    <option value="check">Check grammar</option>
                    <option value="list">List markdowns</option>
                </select>

                <div id="idInputContainer" class="mt-3" style="display:none;">
                    <label for="fileId" class="form-label">Enter the ID:</label>
                    <input type="text" id="fileId" class="form-control bg-dark text-light border-light" placeholder="File ID" />
                </div>

                <button id="goButton" class="btn btn-outline-light mt-3" disabled>Go</button>
            </div>
        </div>
    </div>

    <script>
        const dropdown = document.getElementById('actionDropdown');
        const goButton = document.getElementById('goButton');
        const idInputContainer = document.getElementById('idInputContainer');
        const fileIdInput = document.getElementById('fileId');

        dropdown.addEventListener('change', function () {
            const selected = this.value;

            if (selected === 'render' || selected === 'check') {
                idInputContainer.style.display = 'block';
            } else {
                idInputContainer.style.display = 'none';
                fileIdInput.value = '';
            }
            if (selected === 'list') {
                goButton.disabled = false;
            } else {
                goButton.disabled = true;
            }
        });

        fileIdInput.addEventListener('input', () => {
            goButton.disabled = fileIdInput.value.trim() === '';
        });

        goButton.addEventListener('click', () => {
            const selected = dropdown.value;
            if (selected === 'list') {
                window.location.href = 'http://localhost:8080/files';
            } else {
                const id = fileIdInput.value.trim();
                if (!id) {
                    alert('Please, introduce a valid ID.');
                    return;
                }
                const endpoint = selected === 'render' ? 'render' : 'grammar';
                window.location.href = `http://localhost:8080/${endpoint}/${encodeURIComponent(id)}`;
            }
        });
    </script>
</body>

</html>
